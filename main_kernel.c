#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <stdint.h>
#include <sys/ioctl.h>
#include <linux/spi/spidev.h>
#include <linux/types.h>
#include <pthread.h>
#include <inttypes.h>
#include <time.h>
#include <poll.h>
//header file that has all the params which will be shared between main and kernel module
#include "matrix_kernel.h"

int main(int argc, char **argv)
{
	//used to open device driver, take inputs from user for decide the sequence to be sent to driver.
	int fi,a1,t1,a2,t2,term1,term2;
	
	/* open spi driver that was made by us*/
	fi = open("/dev/LED-Driver", O_RDWR);
	if (fi < 0 ){
		printf("Can not open device file.\n");		
		return 0;
	}

	//10 patterns

	patterns pat = {{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0224,0x0324,0x0424,0x0524,0x0624,0x073C,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x0108,0x0218,0x0308,0x0408,0x0508,0x0608,0x071C,0x0800,0x0C01},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0224,0x0304,0x043c,0x0520,0x0620,0x0720,0x083C,0x0C01},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x0118,0x0224,0x0304,0x0408,0x0504,0x0624,0x0718,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x0112,0x0212,0x0312,0x041E,0x0502,0X0602,0x0702,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0220,0x0320,0x043C,0x0504,0x0604,0x073C,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0220,0x0320,0x043C,0x0524,0x0624,0x073C,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013E,0x0222,0x0304,0x040C,0x0508,0x0608,0x0708,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0224,0x0324,0x043C,0x0524,0x0624,0x073C,0x0800,0x0C01,},	
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,0x013C,0x0224,0x0324,0x043C,0x0504,0x0604,0x073C,0x0800,0x0C01,},
			{0x0F00,0x0A0F,0x0900,0x0B07,0x0C00,},
			};	

	//call to ioctl

	if(ioctl(fi, 1, &pat) < 0) //sending struct with pin of red green and blue to driver
		printf("ioctl failed.");

	//User Input
	printf("Enter 1st Pattern: ");
    	scanf("%d", &a1);

	printf("Enter time for 1st pattern: ");
    	scanf("%d", &t1);	

	printf("Enter 2nd Pattern: ");
    	scanf("%d", &a2);

	printf("Enter time for 2nd pattern: ");
    	scanf("%d", &t2);
	
	printf("Enter termination symbol 1: ");
    	scanf("%d", &term1);

	printf("Enter termination symbol 1: ");
	scanf("%d", &term2);

	//sending sequence to driver's write function
	inputs user = {a1, t1, a2, t2, term1, term2};

	write(fi,&user,sizeof(user));
	
	/* close devices */
	close(fi);
	return 0;
}
